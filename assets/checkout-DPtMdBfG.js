import{g as l,s as u,r as h,a as m,l as d}from"./utils-Ci4j-CPh.js";const c="http://server-nodejs.cit.byui.edu:3000/";async function i(o){const e=await o.json();if(o.ok)return e;throw{name:"servicesError",message:e}}class p{constructor(e){this.category=e,this.path=`../json/${this.category}.json`}async getData(e){const t=await fetch(c+`products/search/${e}`);return(await i(t)).Result}async findProductById(e){const t=await fetch(c+`product/${e}`);return(await i(t)).Result}async checkout(e){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await fetch(c+"checkout/",t).then(i)}}const y=new p;function g(o){const e=new FormData(o),t={};return e.forEach(function(s,a){t[a]=s}),t}function T(o){return o.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class S{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=l(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const s=this.list.map(a=>a.FinalPrice);this.itemTotal=s.reduce((a,n)=>a+n),e.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),s=document.querySelector(this.outputSelector+" #orderTotal");e.innerText="$"+this.shipping,t.innerText="$"+this.tax,s.innerText="$"+this.orderTotal}async checkout(){const e=document.forms.checkout,t=g(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=T(this.list),console.log(t);try{const s=await y.checkout(t);console.log(s),u("so-cart",[]),location.assign("/checkout/success.html")}catch(s){h();for(let a in s.message)m(s.message[a]);console.log(s)}}}d();const r=new S("so-cart",".checkout-summary");r.init();document.querySelector("#zip").addEventListener("blur",r.calculateOrdertotal.bind(r));document.querySelector("#checkoutSubmit").addEventListener("click",o=>{o.preventDefault(),r.checkout()});document.forms.checkout.addEventListener("submit",o=>{o.preventDefault(),r.checkout()});

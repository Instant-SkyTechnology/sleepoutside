import{g as u,s as l,r as m,a as d,l as h}from"./utils-BF2odKZQ.js";const c="http://server-nodejs.cit.byui.edu:3000/";async function n(e){const o=await e.json();if(e.ok)return o;throw{name:"servicesError",message:o}}class p{constructor(o){}async getData(o){const t=await fetch(c+`products/search/${o}`);return(await n(t)).Result}async findProductById(o){const t=await fetch(c+`product/${o}`);return(await n(t)).Result}async checkout(o){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return await fetch(c+"checkout/",t).then(n)}}const y=new p;function S(e){const o=new FormData(e),t={};return o.forEach(function(s,a){t[a]=s}),t}function g(e){return e.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class v{constructor(o,t){this.key=o,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=u(this.key),this.calculateItemSummary()}calculateItemSummary(){const o=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const s=this.list.map(a=>a.FinalPrice);this.itemTotal=s.reduce((a,i)=>a+i),o.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const o=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),s=document.querySelector(this.outputSelector+" #orderTotal");o.innerText="$"+this.shipping,t.innerText="$"+this.tax,s.innerText="$"+this.orderTotal}async checkout(){const o=document.forms.checkout,t=S(o);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=g(this.list),console.log(t);try{console.log("Payload to server:",t);const s=await y.checkout(t);console.log(s),l("so-cart",[]),location.assign("/sleepoutside/checkout/success.html")}catch(s){m();for(let a in s.message)d(s.message[a]);console.log(s)}}}h();const r=new v("so-cart",".checkout-summary");r.init();document.querySelector("#zip").addEventListener("blur",r.calculateOrdertotal.bind(r));document.querySelector("#checkoutSubmit").addEventListener("click",e=>{e.preventDefault(),r.checkout()});document.forms.checkout.addEventListener("submit",e=>{e.preventDefault(),r.checkout()});document.addEventListener("DOMContentLoaded",()=>{const e=JSON.parse(localStorage.getItem("checkoutInfo"))||{};Object.keys(e).length&&(document.querySelector('input[name="firstName"]').value=e.firstName,document.querySelector('input[name="lastName"]').value=e.lastName,document.querySelector('input[name="street"]').value=e.street,document.querySelector('input[name="city"]').value=e.city,document.querySelector('input[name="state"]').value=e.state,document.querySelector('input[name="zip"]').value=e.zip,document.querySelector('input[name="cardNumber"]').value=e.cardNumber,document.querySelector('input[name="exp"]').value=e.exp,document.querySelector('input[name="cvv"]').value=e.cvv)});

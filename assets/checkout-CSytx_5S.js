import{g as l,s as u,r as h,a as d,l as m}from"./utils-BfcjF3J2.js";const c="http://server-nodejs.cit.byui.edu:3000/";async function n(s){const e=await s.json();if(s.ok)return e;throw{name:"servicesError",message:e}}class p{constructor(e){this.category=e,this.path=`../json/${this.category}.json`}async getData(e){const t=await fetch(c+`products/search/${e}`);return(await n(t)).Result}async findProductById(e){const t=await fetch(c+`product/${e}`);return(await n(t)).Result}async checkout(e){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await fetch(c+"checkout/",t).then(n)}}const y=new p;function g(s){const e=new FormData(s),t={};return e.forEach(function(o,r){t[r]=o}),t}function f(s){return s.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class T{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=l(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const o=this.list.map(r=>r.FinalPrice);this.itemTotal=o.reduce((r,i)=>r+i),e.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),o=document.querySelector(this.outputSelector+" #orderTotal");e.innerText="$"+this.shipping,t.innerText="$"+this.tax,o.innerText="$"+this.orderTotal}async checkout(){const e=document.forms.checkout,t=g(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=f(this.list),console.log(t);try{const o=await y.checkout(t);console.log(o),u("so-cart",[]),location.assign("/checkout/success.html")}catch(o){h();for(let r in o.message)d(o.message[r]);console.log(o)}}}m();const a=new T("so-cart",".checkout-summary");a.init();document.querySelector("#zip").addEventListener("blur",a.calculateOrdertotal.bind(a));document.querySelector("#checkoutSubmit").addEventListener("click",async s=>{s.preventDefault();try{await a.checkout()}catch(e){S(e)}});function S(s){const e=document.querySelector("#checkout-errors");if(e.innerHTML="",!s){e.textContent="Checkout failed. Please check your information.";return}s.forEach(t=>{const o=document.createElement("p");o.textContent=t.message||t,o.classList.add("error"),e.appendChild(o)})}document.forms.checkout.addEventListener("submit",s=>{s.preventDefault(),a.checkout()});

import{g as l,s as u,r as h,a as d,l as m}from"./utils-C6Y3MRxF.js";const c="http://server-nodejs.cit.byui.edu:3000/";async function i(a){const e=await a.json();if(a.ok)return e;throw{name:"servicesError",message:e}}class p{constructor(e){this.category=e,this.path=`../json/${this.category}.json`}async getData(e){const t=await fetch(c+`products/search/${e}`);return(await i(t)).Result}async findProductById(e){const t=await fetch(c+`product/${e}`);return(await i(t)).Result}async checkout(e){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await fetch(c+"checkout/",t).then(i)}}const y=new p;function g(a){const e=new FormData(a),t={};return e.forEach(function(o,s){t[s]=o}),t}function f(a){return a.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class T{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=l(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const o=this.list.map(s=>s.FinalPrice);this.itemTotal=o.reduce((s,r)=>s+r),e.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),o=document.querySelector(this.outputSelector+" #orderTotal");e.innerText="$"+this.shipping,t.innerText="$"+this.tax,o.innerText="$"+this.orderTotal}async checkout(){const e=document.forms.checkout,t=g(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=f(this.list),console.log(t);try{const o=await y.checkout(t);console.log(o),u("so-cart",[]),location.assign("/checkout/success.html")}catch(o){h();for(let s in o.message)d(o.message[s]);console.log(o)}}}document.addEventListener("DOMContentLoaded",()=>{m();const a=new T("so-cart",".checkout-summary");a.init(),document.querySelector("#zip").addEventListener("blur",a.calculateOrdertotal.bind(a)),document.forms.checkout.addEventListener("submit",async o=>{o.preventDefault();try{await a.checkout()}catch(s){t(s)}});function t(o){const s=document.querySelector("#checkout-errors");if(s){if(s.innerHTML="",!o||o.length===0){s.textContent="Checkout failed. Please check your information.";return}o.forEach(r=>{const n=document.createElement("p");n.textContent=r.message||r,n.classList.add("error"),s.appendChild(n)}),s.scrollIntoView({behavior:"smooth",block:"start"})}}});
